generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Users of the software

model Usuario {
    id        Int      @id @default(autoincrement())
    email     String   @unique
    username  String?  @unique
    password  String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// Entitie that represents a person
model Persona {
    id       Int     @id @default(autoincrement())
    nombre   String
    apellido String
    telefono String
    email    String?

    Pasajero     Pasajero?
    Conductor    Conductor?
    Remitente    Encomienda[] @relation("remitente")
    Destinatario Encomienda[] @relation("destinatario")
}

//TODO: Correct this model because a Client is at the same time a Person and a User, so Passenger model should be deleted (obsolete)
model Pasajero {
    id        Int     @id @default(autoincrement())
    persona   Persona @relation(fields: [personaId], references: [id])
    personaId Int     @unique
    Boleto    Boleto?
}

// Drivers from the company
model Conductor {
    id        Int     @id @default(autoincrement())
    persona   Persona @relation(fields: [personaId], references: [id])
    personaId Int     @unique
    Viaje     Viaje[]
}

// Travel Tickets generated by the system
model Boleto {
    id          Int      @id @default(autoincrement())
    pasajero    Pasajero @relation(fields: [pasajeroId], references: [id])
    pasajeroId  Int      @unique
    viaje       Viaje    @relation(fields: [viajeId], references: [id])
    viajeId     Int      @unique
    asiento     String
    fechaCompra DateTime
}

// Travels made by the buses from the origin to the destination
model Viaje {
    id           Int          @id @default(autoincrement())
    origen       String
    destino      String
    fechaSalida  DateTime
    fechaLlegada DateTime
    boletos      Boleto[]
    encomiendas  Encomienda[]
    manifiesto   Manifiesto?
    conductores  Conductor[]
    Ruta         Ruta?        @relation(fields: [rutaId], references: [id])
    rutaId       Int?
}

// Packages sent by the users 
model Encomienda {
    id             Int     @id @default(autoincrement())
    remitente      Persona @relation(name: "remitente", fields: [remitenteId], references: [id])
    remitenteId    Int
    destinatario   Persona @relation(name: "destinatario", fields: [destinatarioId], references: [id])
    destinatarioId Int
    contenido      String
    viaje          Viaje?  @relation(fields: [viajeId], references: [id])
    viajeId        Int?
}

// Document that contains the list of passengers, packages and drivers of a travel
model Manifiesto {
    id          Int    @id @default(autoincrement())
    viaje       Viaje  @relation(fields: [viajeId], references: [id])
    viajeId     Int    @unique
    pasajeros   String // lista pasajeros 
    encomiendas String // lista encomiendas
}

// Buses registered in the company
model Bus {
    id       Int    @id @default(autoincrement())
    modelo   String
    placa    String @unique
    asientos Int
}

// Routes that the buses can take
model Ruta {
    id Int @id @default(autoincrement())

    ciudadOrigen     String
    ciudadDestino    String
    duracionEstimada Int?
    tarifas          Int[]

    viajes Viaje[]
}
