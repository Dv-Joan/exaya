generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Users of the software

model Usuario {
    id             String   @id @default(uuid())
    username       String
    password       String
    createdAt      DateTime @default(now())
    cliente        Cliente  @relation(fields: [clienteId], references: [id])
    clienteId      String   @unique
    rol            String
    foto           String?
    sedeDelegacion String
}

model Persona {
    id        String   @id @default(uuid())
    dni       String   @unique
    nombres   String
    apellidos String
    telefono  String
    createdAt DateTime @default(now())
    email     String?
    cliente   Cliente?
}

model Cliente {
    id                   String       @id @default(uuid())
    persona              Persona      @relation(fields: [personaId], references: [id])
    personaId            String       @unique
    usuario              Usuario?
    conductor            Conductor?
    encomiendasEnviadas  Encomienda[] @relation("remitente") // Define the sender relationship
    encomiendasRecibidas Encomienda[] @relation("destinatario") // Define the receiver relationship
    boleto               Boleto?
    manifiestoId         String?
}

model Encomienda {
    id             String      @id @default(uuid())
    remitente      Cliente     @relation(name: "remitente", fields: [remitenteId], references: [id])
    remitenteId    String
    destinatario   Cliente     @relation(name: "destinatario", fields: [destinatarioId], references: [id])
    destinatarioId String
    createdAt      DateTime    @default(now())
    fechaEnvio     DateTime
    comprobante    String
    estado         Boolean
    descripcion    String
    viaje          Viaje       @relation(fields: [viajeId], references: [id])
    viajeId        String
    Manifiesto     Manifiesto? @relation(fields: [manifiestoId], references: [id])
    manifiestoId   String?
}

model Conductor {
    id                 String      @id @default(uuid())
    cliente            Cliente     @relation(fields: [clienteId], references: [id])
    foto               String?
    clienteId          String      @unique
    viaje              Viaje?      @relation(fields: [viajeId], references: [id])
    viajeId            String?
    Manifiesto         Manifiesto? @relation(fields: [manifiestoId], references: [id])
    manifiestoId       String?
    licencia           String
    tipoLicencia       String
    estadoDocumentario String
    disponibilidad     Boolean
}

// Travel Tickets generated by the system
model Boleto {
    id           String   @id @default(uuid())
    cliente      Cliente  @relation(fields: [clienteId], references: [id])
    clienteId    String   @unique
    viaje        Viaje    @relation(fields: [viajeId], references: [id])
    viajeId      String   @unique
    asiento      Int
    fechaCompra  DateTime
    precio       Int
    manifiestoId String?
    createdAt    DateTime @default(now())
}

// Travels made by the buses from the origin to the destination
model Viaje {
    id          String       @id @default(uuid())
    origen      String
    destino     String
    bus         Bus          @relation(fields: [busId], references: [id])
    busId       String
    fechaSalida DateTime
    hora        String
    tarifas     Int[]
    boletos     Boleto[]
    encomiendas Encomienda[]
    conductores Conductor[]
    ruta        Ruta         @relation(fields: [rutaId], references: [id])
    rutaId      String
    manifiesto  Manifiesto?
    createdAt   DateTime     @default(now())
}

// Document that contains the list of passengers, packages and drivers of a travel
model Manifiesto {
    id          String       @id @default(uuid())
    viaje       Viaje        @relation(fields: [viajeId], references: [id])
    viajeId     String       @unique
    encomiendas Encomienda[]
    conductores Conductor[]
}

// Buses registered in the company
model Bus {
    id        String   @id @default(uuid())
    modelo    String
    foto      String
    placa     String   @unique
    asientos  Int
    createdAt DateTime @default(now())
    Viaje     Viaje[]
}

// Routes that the buses can take
model Ruta {
    id               String   @id @default(uuid())
    ciudadOrigen     String
    ciudadDestino    String
    terminalOrigen   String
    terminalDestino  String
    duracionEstimada Int?
    Viaje            Viaje[]
    createdAt        DateTime @default(now())
}
